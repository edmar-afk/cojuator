{% load static %}

<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>Products</title>
		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/bootstrap.min.css' %}" />
		<!-- Typography CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/typography.css' %}" />
		<!-- Style CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/style.css' %}" />
		<!-- Responsive CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/responsive.css' %}" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
			integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer" />
		<!-- DataTables CSS -->
		<link
			rel="stylesheet"
			href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css" />
	</head>
	<body>
		<!-- Wrapper Start -->
		<div class="wrapper">
			<!-- Sidebar  -->
			{% include 'includes/sidebar.html' %}
			<!-- Page Content  -->
			<div
				id="content-page"
				class="content-page">
				<div class="container-fluid">
					<div class="row">
						<div class="col-sm-12">
							<div class="iq-card">
								<div class="iq-card-header d-flex justify-content-between">
									<div class="iq-header-title">
										<h4 class="card-title">Products Lists</h4>
									</div>
									<div class="iq-card-body">
										<!-- Button trigger modal -->
										<button
											type="button"
											class="btn btn-primary"
											data-toggle="modal"
											data-target=".bd-example-modal-lg">
											<i
												class="fa fa-plus-circle"
												aria-hidden="true"></i>
											Add Product
										</button>
									</div>
								</div>
								<div class="iq-card-body">
									{% for message in messages %} {% if message.level_tag == 'success' %}
									<div
										class="alert text-white bg-success"
										role="alert">
										<div class="iq-alert-icon">
											<i
												class="fa fa-check-circle"
												aria-hidden="true"></i>
										</div>
										<div class="iq-alert-text">{{message}}</div>
										<button
											type="button"
											class="close"
											data-dismiss="alert"
											aria-label="Close">
											<i class="ri-close-line"></i>
										</button>
									</div>
									{% else %}
									<div
										class="alert text-white bg-danger"
										role="alert">
										<div class="iq-alert-icon">
											<i
												class="fa fa-exclamation-circle"
												aria-hidden="true"></i>
										</div>
										<div class="iq-alert-text">{{message}}</div>
										<button
											type="button"
											class="close"
											data-dismiss="alert"
											aria-label="Close">
											<i class="ri-close-line"></i>
										</button>
									</div>
									{%endif%} {% endfor %}
									<div class="table-responsive">
										<table
											id="products"
											class="table table-striped table-bordered"
											style="width: 100%">
											<thead>
												<tr>
													<th>Product</th>
													<th>Price (₱)</th>
													<th>Category</th>
													<th>Stocks</th>
													<th>Total Value</th>

													<th>Action</th>
												</tr>
											</thead>
											<tbody>
												{% for list in products %}
												<tr>
													<td>{{list.name}}</td>
													<td class="price">{{ list.price }}</td>
													<td class="d-flex align-items-center">{{list.category.type}}</td>
													<td class="quantity">{{ list.quantity }}</td>
													<td class="total-worth"></td>
													<td>
														<a
															href="{% url 'removeProduct' list.id %}"
															class="btn btn-danger text-white"
															onclick="return confirmDelete{{list.id}}()">
															<i
																class="fa fa-trash"
																aria-hidden="true"></i>
															Delete
														</a>
														<button
															type="button"
															data-toggle="modal"
															data-target=".modal{{list.id}}"
															class="btn btn-primary text-white">
															<i
																class="fa fa-pencil"
																aria-hidden="true"></i>
															Edit
														</button>
													</td>
												</tr>

												<div
													class="modal fade modal{{list.id}}"
													tabindex="-1"
													role="dialog"
													aria-hidden="true">
													<div class="modal-dialog modal-lg">
														<form
															action="{% url 'editProduct' list.id %}"
															method="post"
															enctype="multipart/form-data">
															{% csrf_token %}
															<div class="modal-content">
																<div class="modal-header">
																	<h5 class="modal-title">
																		Edit
																		<span class="text-primary">{{list.name}}</span>
																		Product
																	</h5>
																	<button
																		type="button"
																		class="close"
																		data-dismiss="modal"
																		aria-label="Close">
																		<span aria-hidden="true">&times;</span>
																	</button>
																</div>
																<div class="modal-body">
																	<div class="form-row">
																		<div class="col">
																			<label>Product Name</label>
																			<input
																				type="text"
																				name="product_name"
																				class="form-control"
																				value="{{list.name}}" />
																		</div>
																		<div class="col">
																			<label>Category</label>
																			<select
																				name="category"
																				class="form-control form-control-lg">
																				<option
																					value="{{list.category.type}}"
																					selected>
																					{{list.category.type}}
																				</option>
																				{% for list in categories %}
																				<option value="{{list.type}}">{{list.type}}</option>
																				{% endfor %}
																			</select>
																		</div>
																	</div>

																	<div class="form-row mt-4">
																		<div class="col">
																			<label>Product Price (₱)</label>

																			<input
																				type="text"
																				id="price"
																				name="price"
																				class="form-control"
																				value="{{list.price}}" />
																		</div>
																		<div class="col">
																			<label>Quantity</label>
																			<input
																				type="number"
																				id="quantity"
																				name="quantity"
																				class="form-control"
																				value="{{list.quantity}}" />
																		</div>
																	</div>

																	<h5 class="mt-5">
																		Total Worth of Value: ₱
																		<span id="totalValue">0.00</span>
																	</h5>
																</div>
																<div class="modal-footer">
																	<button
																		type="button"
																		class="btn btn-secondary"
																		data-dismiss="modal">
																		Close
																	</button>
																	<button
																		type="submit"
																		name="submit"
																		class="btn btn-primary">
																		Save Product
																	</button>
																</div>
															</div>
														</form>
													</div>
												</div>
												<script>
													function confirmDelete{{list.id}}() {
														return confirm("Are you sure you want to delete {{list.name}} Product?");
													}
												</script>
												{% endfor %}
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div
			class="modal fade bd-example-modal-lg"
			tabindex="-1"
			role="dialog"
			aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<form
					method="post"
					enctype="multipart/form-data">
					{% csrf_token %}
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Add Product</h5>
							<button
								type="button"
								class="close"
								data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<div class="form-row">
								<div class="col">
									<label>Product Name</label>
									<input
										type="text"
										name="product_name"
										class="form-control"
										placeholder="Product name" />
								</div>
								<div class="col">
									<label>Category</label>
									<select
										name="category"
										class="form-control form-control-lg">
										{% for list in categories %}
										<option
											selected
											value="{{list.type}}">
											{{list.type}}
										</option>
										{% endfor %}
									</select>
								</div>
							</div>

							<div class="form-row mt-4">
								<div class="col">
									<label>Product Price (₱)</label>
									<input
										type="text"
										id="price1"
										name="price"
										class="form-control"
										placeholder="Price of each Item" />
								</div>
								<div class="col">
									<label>Quantity</label>
									<input
										type="number"
										id="quantity1"
										name="quantity"
										class="form-control"
										placeholder="" />
								</div>
							</div>

							<h5 class="mt-5">
								Total Worth of Value: ₱
								<span id="totalValue1">0.00</span>
							</h5>
						</div>
						<div class="modal-footer">
							<button
								type="button"
								class="btn btn-secondary"
								data-dismiss="modal">
								Close
							</button>
							<button
								type="submit"
								name="submit"
								class="btn btn-primary">
								Save Product
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<!-- Wrapper END -->
		<!-- Footer -->
		{% include 'includes/footer.html' %}

		<script>
			document.addEventListener("DOMContentLoaded", (event) => {
				const priceInput = document.getElementById("price");
				const quantityInput = document.getElementById("quantity");
				const totalValueSpan = document.getElementById("totalValue");

				// Event listeners for input changes
				priceInput.addEventListener("input", calculateTotal);
				quantityInput.addEventListener("input", calculateTotal);

				// Initial calculation on page load
				calculateTotal();

				function calculateTotal() {
					const price = parseFloat(priceInput.value) || 0;
					const quantity = parseInt(quantityInput.value) || 0;
					const total = price * quantity;
					totalValueSpan.textContent = total.toFixed(2);
				}
			});
		</script>

		<script>
			document.getElementById("price1").addEventListener("input", calculateTotal);
			document.getElementById("quantity1").addEventListener("input", calculateTotal);

			function calculateTotal() {
				const price = parseFloat(document.getElementById("price1").value) || 0;
				const quantity = parseInt(document.getElementById("quantity1").value) || 0;
				const total = price * quantity;
				document.getElementById("totalValue1").textContent = total.toFixed(2);
			}
		</script>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				console.log("DOM fully loaded and parsed");

				// Get all the rows of the table
				var rows = document.querySelectorAll("tr");

				rows.forEach(function (row, index) {
					// Skip the header row
					if (index === 0) return;

					// Get the price and quantity elements
					var priceElement = row.querySelector(".price");
					var quantityElement = row.querySelector(".quantity");
					var totalWorthElement = row.querySelector(".total-worth");

					// Ensure the elements exist before trying to access their values
					if (priceElement && quantityElement && totalWorthElement) {
						var price = parseFloat(priceElement.textContent);
						var quantity = parseFloat(quantityElement.textContent);

						console.log(`Row ${index} - Price: ${price}, Quantity: ${quantity}`);

						// Check if the parsed values are numbers
						if (!isNaN(price) && !isNaN(quantity)) {
							// Calculate the total worth
							var totalWorth = price * quantity;

							// Display the total worth in the appropriate element
							totalWorthElement.textContent = "₱ " + totalWorth.toFixed(2); // Format to 2 decimal places

							console.log(`Row ${index} - Total Worth: ${totalWorth.toFixed(2)}`);
						} else {
							// If values are not numbers, display an error or zero
							totalWorthElement.textContent = "0.00";
							console.log(`Row ${index} - Invalid number`);
						}
					} else {
						console.log(`Row ${index} - Missing elements`);
					}
				});
			});
		</script>

		<script>
			function formatPrice(value) {
				// Remove all characters except digits and a single decimal point
				return value
					.replace(/[^0-9.]/g, "") // Remove non-numeric characters except dot
					.replace(/(\..*)\./g, "$1") // Remove extra dots
					.replace(/^(\d+(\.\d{0,2})?).*$/, "$1"); // Limit to two decimal places
			}

			document.getElementById("price").addEventListener("input", function (event) {
				this.value = formatPrice(this.value);
			});

			document.getElementById("price").addEventListener("paste", function (event) {
				event.preventDefault(); // Prevent the default paste action
				const pasteData = (event.clipboardData || window.clipboardData).getData("text");
				this.value = formatPrice(pasteData);
			});
		</script>

		<script>
			function formatPrice1(value) {
				// Remove all characters except digits and a single decimal point
				return value
					.replace(/[^0-9.]/g, "") // Remove non-numeric characters except dot
					.replace(/(\..*)\./g, "$1") // Remove extra dots
					.replace(/^(\d+(\.\d{0,2})?).*$/, "$1"); // Limit to two decimal places
			}

			document.getElementById("price1").addEventListener("input", function (event) {
				this.value = formatPrice1(this.value);
			});

			document.getElementById("price").addEventListener("paste", function (event) {
				event.preventDefault(); // Prevent the default paste action
				const pasteData = (event.clipboardData || window.clipboardData).getData("text");
				this.value = formatPrice1(pasteData);
			});
		</script>

		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<!-- Bootstrap JS -->
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
		<!-- DataTables JS -->
		<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
		<script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>

		<!-- Initialize DataTable -->
		<script>
			$(document).ready(function () {
				$("#products").DataTable({
					searching: true, // Enables the search functionality
					ordering: true, // Enables the sorting functionality
				});
			});
		</script>

		<!-- Custom Scripts -->
		<script src="{% static 'js/popper.min.js' %}"></script>
		<script src="{% static 'js/bootstrap.min.js' %}"></script>
		<script src="{% static 'js/jquery.appear.js' %}"></script>
		<script src="{% static 'js/countdown.min.js' %}"></script>
		<script src="{% static 'js/waypoints.min.js' %}"></script>
		<script src="{% static 'js/jquery.counterup.min.js' %}"></script>
		<script src="{% static 'js/wow.min.js' %}"></script>
		<script src="{% static 'js/apexcharts.js' %}"></script>
		<script src="{% static 'js/slick.min.js' %}"></script>
		<script src="{% static 'js/select2.min.js' %}"></script>
		<script src="{% static 'js/owl.carousel.min.js' %}"></script>
		<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
		<script src="{% static 'js/smooth-scrollbar.js' %}"></script>
		<script src="{% static 'js/lottie.js' %}"></script>
		<script src="{% static 'js/chart-custom.js' %}"></script>
		<script src="{% static 'js/custom.js' %}"></script>
	</body>
</html>
