{% load static %}

<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>Cuajotor Store</title>
		<!-- Favicon -->

		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/bootstrap.min.css' %}" />
		<!-- Typography CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/typography.css' %}" />
		<!-- Style CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/style.css' %}" />
		<!-- Responsive CSS -->
		<link
			rel="stylesheet"
			href="{% static 'css/responsive.css' %}" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
			integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer" />
	</head>
	<body>
		<!-- Wrapper Start -->
		<div class="wrapper">
			<!-- Sidebar  -->
			{% include 'includes/sidebar.html' %}
			<!-- Page Content  -->
			<div
				id="content-page"
				class="content-page">
				<div class="container-fluid">
					<div class="">
						<div class="row">
							<div class="col-lg-8">
								<div class="iq-card iq-card-block iq-card-stretch iq-card-height overflow-hidden">
									<div class="iq-card">
										<div class="iq-card-header d-flex justify-content-between">
											<div class="iq-header-title">
												<h4 class="card-title">Checkout Product</h4>
											</div>
										</div>
										<div class="iq-card-body">
											{% for message in messages %} {% if message.level_tag == 'success' %}
											<div
												class="alert text-white bg-success"
												role="alert">
												<div class="iq-alert-icon">
													<i
														class="fa fa-check-circle"
														aria-hidden="true"></i>
												</div>
												<div class="iq-alert-text">{{message}}</div>
												<button
													type="button"
													class="close"
													data-dismiss="alert"
													aria-label="Close">
													<i class="ri-close-line"></i>
												</button>
											</div>
											{% else %}
											<div
												class="alert text-white bg-danger"
												role="alert">
												<div class="iq-alert-icon">
													<i
														class="fa fa-exclamation-circle"
														aria-hidden="true"></i>
												</div>
												<div class="iq-alert-text">{{message}}</div>
												<button
													type="button"
													class="close"
													data-dismiss="alert"
													aria-label="Close">
													<i class="ri-close-line"></i>
												</button>
											</div>
											{%endif%} {% endfor %}
											<p>
												<i
													class="fa fa-exclamation-circle text-primary"
													aria-hidden="true"></i>
												Always check your stocks in your products, 0 stock will
												<span class="text-danger font-weight-bold">unable</span>
												to checkout.
											</p>
											<form
												method="post" action="{% url 'checkout' %}">
												{% csrf_token %}
												<div class="form-row">
													<div class="col-md-6 mb-3">
														<label for="product">Select Product</label>
														<select
															class="form-control"
															id="product"
															name="product"
															required>
															<option value="">--Select a Product--</option>
															{% for item in products %}
															<option
																value="{{ item.id }}"
																data-quantity="{{ item.quantity }}"
																data-price="{{ item.price }}"
																data-name="{{ item.name }}">
																{{ item.name }}
															</option>
															{% endfor %}
														</select>
														<div
															id="stock-info"
															class="text-primary font-weight-bold">
															0 Stocks
														</div>
													</div>
													<div class="col-md-6 mb-3">
														<label for="quantity">Quantity</label>
														<input
															type="number"
															name="quantity"
															class="form-control"
															id="quantity"
															min="1"
															required />
														<p
															id="quantity-error"
															class="text-danger font-weight-bold"
															style="display: none">
															<i
																class="fa fa-exclamation-triangle"
																aria-hidden="true"></i>
															Quantity is higher than the stock
														</p>
													</div>

													<input
														type="hidden"
														name="totalAmount"
														class="form-control"
														id="totalAmount"
														value=""
														required />

													<div class="col mb-3">
														<label for="buyerAmount">Buyer Amount</label>
														<div class="input-group">
															<div class="input-group-prepend">
																<span
																	class="input-group-text"
																	id="inputGroupPrepend2">
																	₱
																</span>
															</div>
															<input
																type="number"
																id="buyerAmount"
																class="form-control"
																aria-describedby="inputGroupPrepend2"
																required />
														</div>
													</div>
												</div>

												<div class="form-group">
													<button
														type="submit"
														name="submit"
														id="checkout-btn"
														class="btn btn-danger"
														disabled>
														Checkout
													</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<div class="col-lg-4">
								<div class="iq-card iq-card-block iq-card-stretch iq-card-height animation-card">
									<div class="iq-card-body p-0">
										<div class="mt-3 ml-4 mr-4">
											<span class="h5 text-dark">Reciept Overview</span>
											<div class="mt-5 h6 col">
												<div class="d-flex justify-content-between">
													<p>Product Name:</p>
													<p
														id="product-name"
														class="text-primary">
														N/A
													</p>
												</div>
												<div class="d-flex justify-content-between">
													<p>Product Price:</p>
													<p
														id="price-info"
														class="text-primary">
														₱00.0
													</p>
												</div>
												<div class="d-flex justify-content-between">
													<div><p>Quantity:</p></div>
													<div class="d-flex">
														<span class="text-primary">x</span>
														<p
															id="quantity-info"
															class="text-primary">
															0
														</p>
													</div>
												</div>

												<div class="d-flex justify-content-between">
													<p>Total Amount:</p>
													<div class="d-flex text-primary">
														₱
														<p
															id="totalAmount-info"
															class="text-primary">
															0.00
														</p>
													</div>
												</div>

												<div class="d-flex justify-content-between mt-4">
													<p>Buyer Amount:</p>
													<p
														id="buyerAmount-info"
														class="text-primary">
														₱0.00
													</p>
												</div>
												<div class="d-flex justify-content-between">
													<p>Sukli:</p>
													<p
														id="sukli-info"
														class="text-primary">
														₱0.00
													</p>
												</div>
											</div>
											<center><p class="h1 mt-4">Cuajotor Store</p></center>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Wrapper END -->
		<!-- Footer -->

		{% include 'includes/footer.html' %}

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				// Get the value from the <p> tag
				var totalAmountInfo = document.getElementById("totalAmount-info").textContent.trim();
				// Set the value to the <input> tag
				var totalAmountInput = document.getElementById("totalAmount");
				totalAmountInput.value = parseFloat(totalAmountInfo);
			});

			function updateTotalAmount() {
				var selectedOption =
					document.getElementById("product").options[document.getElementById("product").selectedIndex];
				var price = selectedOption ? selectedOption.getAttribute("data-price") : 0;
				var quantity = document.getElementById("quantity").value;
				var totalAmount = parseFloat(price) * quantity;
				document.getElementById("totalAmount-info").textContent = "" + totalAmount.toFixed(2);

				// Update the input field value
				var totalAmountInput = document.getElementById("totalAmount");
				totalAmountInput.value = totalAmount.toFixed(2);

				return totalAmount;
			}

			function updateSukli() {
				var buyerAmount = parseFloat(document.getElementById("buyerAmount").value) || 0;
				var totalAmount = updateTotalAmount();
				var sukli = buyerAmount - totalAmount;
				document.getElementById("sukli-info").textContent = "₱" + sukli.toFixed(2);
			}

			document.getElementById("product").addEventListener("change", function () {
				var selectedOption = this.options[this.selectedIndex];
				var quantity = selectedOption ? selectedOption.getAttribute("data-quantity") : 0;
				var price = selectedOption ? selectedOption.getAttribute("data-price") : 0;
				var name = selectedOption ? selectedOption.getAttribute("data-name") : "None";
				var checkoutBtn = document.getElementById("checkout-btn");
				var quantityInput = document.getElementById("quantity");
				var quantityError = document.getElementById("quantity-error");
				var quantityInfo = document.getElementById("quantity-info");

				if (quantity && quantity > 0) {
					document.getElementById("product-name").textContent = name;
					document.getElementById("stock-info").textContent = "Stock: " + quantity + " remaining";
					document.getElementById("price-info").textContent = "" + parseFloat(price).toFixed(2);
					quantityInput.max = quantity; // Set the max value for the input field
					checkoutBtn.disabled = false;
					checkoutBtn.classList.remove("btn-danger");
					checkoutBtn.classList.add("btn-primary");
					quantityError.style.display = "none"; // Hide error message
					quantityInfo.textContent = 0;
					document.getElementById("totalAmount-info").textContent = "0.00";
				} else {
					document.getElementById("product-name").textContent = "Product Name: None";
					document.getElementById("stock-info").textContent = "Stock: 0";
					document.getElementById("price-info").textContent = "0.00";
					checkoutBtn.disabled = true;
					checkoutBtn.classList.remove("btn-primary");
					checkoutBtn.classList.add("btn-danger");
					quantityError.style.display = "none"; // Hide error message
					quantityInfo.textContent = 0;
					document.getElementById("totalAmount-info").textContent = "₱0.00";
				}
				updateSukli();
			});

			document.getElementById("quantity").addEventListener("input", function () {
				var selectedOption =
					document.getElementById("product").options[document.getElementById("product").selectedIndex];
				var maxQuantity = selectedOption ? selectedOption.getAttribute("data-quantity") : 0;
				var inputQuantity = this.value;
				var quantityError = document.getElementById("quantity-error");
				var quantityInfo = document.getElementById("quantity-info");

				quantityInfo.textContent = inputQuantity;

				if (inputQuantity > maxQuantity) {
					quantityError.style.display = "block"; // Show error message
					document.getElementById("totalAmount-info").textContent = "₱0.00";
				} else {
					quantityError.style.display = "none"; // Hide error message
					updateTotalAmount();
				}
				updateSukli();
			});

			document.getElementById("buyerAmount").addEventListener("input", function () {
				var buyerAmount = this.value;
				document.getElementById("buyerAmount-info").textContent = "₱" + parseFloat(buyerAmount).toFixed(2);
				updateSukli();
			});
		</script>
		<script src="{% static 'js/jquery.min.js' %}"></script>
		<script src="{% static 'js/popper.min.js' %}"></script>
		<script src="{% static 'js/bootstrap.min.js' %}"></script>
		<!-- Appear JavaScript -->
		<script src="{% static 'js/jquery.appear.js' %}"></script>
		<!-- Countdown JavaScript -->
		<script src="{% static 'js/countdown.min.js' %}"></script>
		<!-- Counterup JavaScript -->
		<script src="{% static 'js/waypoints.min.js' %}"></script>
		<script src="{% static 'js/jquery.counterup.min.js' %}"></script>
		<!-- Wow JavaScript -->
		<script src="{% static 'js/wow.min.js' %}"></script>
		<!-- Apexcharts JavaScript -->
		<script src="{% static 'js/apexcharts.js' %}"></script>
		<!-- Slick JavaScript -->
		<script src="{% static 'js/slick.min.js' %}"></script>
		<!-- Select2 JavaScript -->
		<script src="{% static 'js/select2.min.js' %}"></script>
		<!-- Owl Carousel JavaScript -->
		<script src="{% static 'js/owl.carousel.min.js' %}"></script>
		<!-- Magnific Popup JavaScript -->
		<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
		<!-- Smooth Scrollbar JavaScript -->
		<script src="{% static 'js/smooth-scrollbar.js' %}"></script>
		<!-- lottie JavaScript -->
		<script src="{% static 'js/lottie.js' %}"></script>
		<!-- Chart Custom JavaScript -->
		<script src="{% static 'js/chart-custom.js' %}"></script>
		<!-- Custom JavaScript -->
		<script src="{% static 'js/custom.js' %}"></script>
	</body>
</html>
